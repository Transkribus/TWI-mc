{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% block title %}Project - {{ collection.name }} - Transkribus{% endblock %}
{% block styles %}
<link href="{% static 'projects/css/base.css' %}" rel="stylesheet">
<style>
 .card-list-item.active {
   box-shadow: 0 0 8px rgba(0, 0, 255, 0.25);
 }
</style>
{% endblock styles %}
{% block scripts %}
<script src="{% static "sandbox/js/lib/utils.js" %}"></script>
<script src="{% static "sandbox/js/lib/api.js" %}"></script>
<script>
 window.addEventListener('load', function (evt) {

   var mainNode = document.querySelector('.js-project');
   var activeNode = null;

   mainNode.addEventListener('click', function (evt) {
     /* highlight most recently clicked card, so people don't lose
        track of where they left off */
     if (evt.target.classList.contains('js-link')) {
       var node = evt.target;
       while (node.parentNode && !test(node)) {
         node = node.parentNode;
       }

       if (activeNode && activeNode.classList.contains('active')) {
         activeNode.classList.remove('active');

       }

       activeNode = node;

       if (activeNode) {
         activeNode.classList.add('active');
       }

     }
   }, false);
   function test(node) {
     if (!node.classList)
       return true;
     console.log(node.classList);
     return node.classList.contains('js-card-list-item');
   }
 });
</script>
{% endblock %}
{% block content %}
<div class="container">
  <section class="project js-project">
    <header>
      <div class="row">
        <div class="col-md-12">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a href="{% url 'projects:project-list' %}">
                <span class="glyphicon glyphicon-home"></span> {% trans "Home"%}
              </a>
            </li>
            <li class="breadcrumb-item">
              <a href="{% url 'projects:project-detail' slug %}">{{ collection.name }} ({{ collection.id }})</a>
            </li>
          </ol>
        </div>
      </div>
    </header>
    <main>
      <div class="row">
        <div class="col-md-12">
          <div class="collection">
            <a href="{% url 'projects:project-detail' slug %}">
              <h1>
                {% if collection.title %}
                {{ collection.title }}
                {% else %}
                {{ collection.name }}
                {% endif %}
                ({{ collection.id }})
              </h1>
            </a>
            {% comment %}
            <h2>
              Documents ({{ collection.num_docs }})
            </h2>
            {% endcomment %}
            <p>
              {% include 'projects/includes/progress.html' with items=collection.progress %}
            </p>
          </div>
        </div>        
      </div>
      <div class="row">
        <div class="col-md-12">
          <form action="{% url 'projects:project-detail' slug %}">
            <label for="doc-id">
              {% trans "Document" %}:
            </label>
            <select id="doc-id" name="docId" onchange="this.form.submit();">
              <option value="" "{% if selected_document_id == None %} selected{% endif %}>Select a document ...</option>
              {% for doc in documents %}
              <option value="{{ doc.id }}"{% if selected_document_id == doc.id %} selected{% endif %}>
                {{ doc.title }} ({{ doc.id }})
              </option>
              {% endfor %}
            </select>
          </form>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          {% if not selected_document %}
          <h4>{% trans "No document selected" %}</h4>
          {% else %}
          {% with document=selected_document %}
          <a href="{% url 'projects:project-detail' slug %}/?docId={{ document.id }}">
            <h2>{{ document.title }} ({{ document.id }})</h2>
          </a>
          <h3>Pages ({{ document.num_pages }})</h3>
          <p>
            {% include 'projects/includes/progress.html' with items=document.progress %}
          </p>
          {% load cache %}
          {% cache 60 pagelist collection.id document.id %}
          <div class="card-list">
            {% for page in document.pages %}
            {% include 'projects/meh.html' %}
            {% endfor %}
          </div>
          {% endcache %}
          {% endwith %}
          {% endif %}
        </div>
      </div>
    </main>
  </section>
</div>
{% endblock content %}
{% block footer %}
{% endblock footer %}
